/tmp/tmpXXhgc6e9.asm:
     1                          MODULE psg_envelope_asm
     2                          LINE 0, "psg_envelope.asm"
psg_envelope.asm:
                                
     1                          	SECTION code_clib
     2                          
     3                          IF !__CPU_INTEL__ & !__CPU_RABBIT__ & !__CPU_GBZ80__
     4                          	PUBLIC	psg_envelope
     5                          	PUBLIC	_psg_envelope
     6                          	PUBLIC	___psg_envelope
     7                          
     8                          ;
     9                          
    10                          ;	$Id: psg_envelope.asm $
    11                          
    12                          ;========================================================================================
    13                          ; void psg_envelope(unsigned int waveform, int period, unsigned int channel) __smallc;
    14                          ;========================================================================================
    15                          ;  foo entry, envelope is not avaliable on SN76489
    16                          ;==============================================================
    17                          
    18                          	INCLUDE	"sn76489.inc"
    19                          
    20                          .psg_envelope
    21                          ._psg_envelope
    22                          .___psg_envelope
    23                          
    24                          	ld	hl, 2
    25                          	add	hl, sp
    26                          	ld	c, (hl)		; C = Channel
    27                          
    28                          	ld	a, $0F		; max attenuation,
    29                          	ld	b, a		; ..only the 4 lower bits are significant
    30                          
    31                          	ld	a, c
    32                          	rrc	a
    33                          	rrc	a
    34                          	rrc	a
    35                          	and	a, $60		; Puts the channel number in bits 5 and 6
    36                          
    37                          	or	a, $90
    38                          	or	a, b		; Prepares the first byte of the command
    39                          IF HAVE16bitbus
    40                          	ld	bc,psgport
    41                          	out	(c),a
    42                          ELSE
    43                          	out	(psgport), a	; Sends it
    44                            IF PSGLatchPort
    45                              in a,(PSGLatchPort)
    46                            ENDIF
    47                          ENDIF
    48                          
    49                          	ret
    50                          ENDIF
    51                          
