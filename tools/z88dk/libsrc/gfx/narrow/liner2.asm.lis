/tmp/tmpXXLlJaXP.asm:
     1                          MODULE liner2_asm
     2                          LINE 0, "liner2.asm"
liner2.asm:
                                
     1                                  INCLUDE "graphics/grafix.inc"
../../graphics/grafix.inc:
     1                          ;
     2                          ;       Z88 Graphics Functions - Small C+ stubbs
     3                          ;
     4                          ;       Written around the Interlogic Standard Library
     5                          ;
     6                          ;       Stubs Written by D Morris - 30/9/98
     7                          ;
     8                          ;
     9                          ;       Define for graphics and other standard library functions
    10                          ;       See also text/textgfx.inc and text6/textgfx.inc
    11                          ;
    12                          ;
    13                          ;    $Id: grafix.inc $
    14                          ;
    15                          
    16                          
    17                          IF FORti82
    18                              DEFINE gotgfx
    19                              defc row_bytes    = 12
    20                              defc maxx    = 96
    21                              defc maxy    = 64
    22                          ENDIF
    23                          
    24                          IF FORti83
    25                              DEFINE gotgfx
    26                              defc row_bytes    = 12
    27                              defc maxx    = 96
    28                              defc maxy    = 64
    29                          ENDIF
    30                          
    31                          IF FORti83p
    32                              DEFINE gotgfx
    33                              defc row_bytes    = 12
    34                              defc maxx    = 96
    35                              defc maxy    = 64
    36                          ENDIF
    37                          
    38                          IF FORti85
    39                              DEFINE gotgfx
    40                              defc row_bytes    = 16
    41                              defc maxx    = 128
    42                              defc maxy    = 64
    43                          ENDIF
    44                          
    45                          IF FORti86
    46                              DEFINE gotgfx
    47                              defc row_bytes    = 16
    48                              defc maxx    = 128
    49                              defc maxy    = 64
    50                          ENDIF
    51                          
    52                          IF FORpc6001
    53                              DEFINE gotgfx
    54                              defc maxx    = 256
    55                              defc maxy    = 192
    56                              defc blankch    = 0
    57                              defc USEplotc   = 1        ; We call generic_console_plotc, not _printc for text mode
    58                              defc    WANT_swapgfxbk = 0
    59                          ENDIF
    60                          
    61                          IF FORpc88
    62                              DEFINE gotgfx
    63                              defc maxx    = 640
    64                              defc maxy    = 200
    65                              defc    WANT_swapgfxbk = 0
    66                          ENDIF
    67                          
    68                          IF FORvz
    69                              DEFINE gotgfx
    70                              IF BLOCKgfx
    71                                  defc maxx    = 64
    72                                        defc maxy    = 32
    73                              ELSE
    74                                  defc maxx    = 128
    75                                        defc maxy    = 64
    76                              ENDIF
    77                              defc USEplotc   = 1        ; We call generic_console_plotc, not _printc for text mode
    78                              defc    WANT_swapgfxbk = 0
    79                          ENDIF
    80                          
    81                          IF FORg800
    82                              DEFINE gotgfx
    83                              defc maxx    = 143    ; display size of the PC-G850
    84                              defc maxy    = 47    ; (a different "getmaxy" is provided for G800 and smaller ones)
    85                          ENDIF
    86                          
    87                          IF FORh19
    88                              DEFINE gotgfx
    89                              defc maxx    = 80
    90                              defc maxy    = 72
    91                              defc    WANT_swapgfxbk = 0
    92                          ENDIF
    93                          
    94                          IF FORabc80
    95                              DEFINE gotgfx
    96                              defc maxx    = 78
    97                              defc maxy    = 72
    98                          ENDIF
    99                          
   100                          IF FORbee
   101                              DEFINE gotgfx
   102                              defc maxx    = 160
   103                              defc maxy    = 75
   104                              defc blankch    = 128
   105                          ENDIF
   106                          
   107                          IF FORbeehr
   108                              DEFINE gotgfx
   109                              defc maxx    = 640
   110                              defc maxy    = 275
   111                          ENDIF
   112                          
   113                          IF FORbeehr320
   114                              DEFINE gotgfx
   115                              defc maxx    = 320
   116                              defc maxy    = 275
   117                          ENDIF
   118                          
   119                          IF FORbeehr512
   120                              DEFINE gotgfx
   121                              defc maxx    = 512
   122                              defc maxy    = 256
   123                          ENDIF
   124                          
   125                          IF FORgemini
   126                              DEFINE gotgfx
   127                              defc maxx    = 160
   128                              defc maxy    = 75
   129                              defc blankch    = 128
   130                          ENDIF
   131                          
   132                          IF FORgeminihr
   133                              DEFINE gotgfx
   134                              defc maxx    = 256
   135                              defc maxy    = 256
   136                              defc blankch    = 128
   137                          ENDIF
   138                          
   139                          IF FORzx80
   140                              DEFINE gotgfx
   141                              defc maxx    = 64
   142                              defc maxy    = 48
   143                          ENDIF
   144                          
   145                          IF FORzx81
   146                              DEFINE gotgfx
   147                              defc maxx    = 64
   148                              defc maxy    = 48
   149                              defc blankch    = 0
   150                          ENDIF
   151                          
   152                          IF FORlambda
   153                              DEFINE gotgfx
   154                              defc maxx    = 64
   155                              defc maxy    = 48
   156                              defc blankch    = 0
   157                          ENDIF
   158                          
   159                          IF FORzx81udg
   160                              DEFINE gotgfx
   161                              defc maxx    = 64
   162                              defc maxy    = 71
   163                              defc blankch    = 0
   164                          ENDIF
   165                          
   166                          IF FORzx81phrg
   167                              DEFINE gotgfx
   168                              defc maxx    = 128
   169                              defc maxy    = 96    ; This one can be changed !  1..200 are theorical valid values !
   170                          ENDIF
   171                          
   172                          IF FORzx81hr64
   173                              DEFINE gotgfx
   174                              defc maxx    = 256
   175                              defc maxy    = 64
   176                          ENDIF
   177                          
   178                          IF FORzx81hr192
   179                              DEFINE gotgfx
   180                              defc maxx    = 256
   181                              defc maxy    = 192
   182                          ENDIF
   183                          
   184                          IF FORzx81mt64
   185                              DEFINE gotgfx
   186                              defc maxx    = 248
   187                              defc maxy    = 64
   188                          ENDIF
   189                          
   190                          IF FORzx81mt192
   191                              DEFINE gotgfx
   192                              defc maxx    = 248
   193                              defc maxy    = 192
   194                          ENDIF
   195                          
   196                          IF FORzx81g007
   197                              DEFINE gotgfx
   198                              defc maxx    = 256    ; It could be 272 but we should switch to 'wide' mode
   199                              defc maxy    = 185
   200                          ENDIF
   201                          
   202                          IF FORaceudg
   203                              DEFINE gotgfx
   204                              defc maxx    = 64
   205                              defc maxy    = 72
   206                              defc blankch    = 32
   207                              defc    WANT_swapgfxbk = 0
   208                          ENDIF
   209                          
   210                          IF FORace
   211                              DEFINE gotgfx
   212                              defc maxx    = 64
   213                              defc maxy    = 48
   214                              defc blankch    = 32
   215                              defc    WANT_swapgfxbk = 0
   216                          ENDIF
   217                          
   218                          IF FORkaypro
   219                              DEFINE gotgfx
   220                              defc maxx    = 160
   221                              defc maxy    = 100
   222                          ENDIF
   223                          
   224                          IF FORbondwell
   225                              DEFINE gotgfx
   226                              defc maxx    = 160
   227                              defc maxy    = 75
   228                              defc    WANT_swapgfxbk = 0
   229                          ENDIF
   230                          
   231                          IF FORbondwell2
   232                              DEFINE gotgfx
   233                              defc maxx    = 640
   234                              defc maxy    = 200
   235                          ENDIF
   236                          
   237                          IF FORkaypro83
   238                              DEFINE gotgfx
   239                              defc maxx    = 80
   240                              defc maxy    = 50
   241                          ENDIF
   242                          
   243                          IF FORosborne1
   244                              DEFINE gotgfx
   245                              defc maxx    = 104
   246                              defc maxy    = 48
   247                              defc blankch    = 32
   248                          ENDIF
   249                          
   250                          IF FORzx
   251                           IF !FORts2068
   252                              DEFINE gotgfx
   253                              defc maxx    = 256
   254                              defc maxy    = 192
   255                              defc    WANT_swapgfxbk = 0
   256                           ENDIF
   257                          ENDIF
   258                          
   259                          IF FORcpc
   260                              DEFINE gotgfx
   261                              defc maxx    = 640
   262                              defc maxy    = 200
   263                              defc    WANT_swapgfxbk = 0
   264                          ENDIF
   265                          
   266                          IF FORpcw
   267                              DEFINE gotgfx
   268                              defc maxx    = 720
   269                              defc maxy    = 256
   270                          ENDIF
   271                          
   272                          IF FOReinstein
   273                              DEFINE gotgfx
   274                              defc maxx    = 256
   275                              defc maxy    = 192
   276                              defc fcolor    = 1
   277                              defc    WANT_swapgfxbk = 0
   278                          ENDIF
   279                          
   280                          IF FORmbc200
   281                              DEFINE gotgfx
   282                              defc maxx    = 640
   283                              defc maxy    = 400
   284                          ENDIF
   285                          
   286                          IF FORv1050
   287                              DEFINE gotgfx
   288                              defc maxx    = 640
   289                              defc maxy    = 300
   290                          ENDIF
   291                          
   292                          IF FORmsx
   293                              DEFINE gotgfx
   294                              defc maxx    = 256
   295                              defc maxy    = 192
   296                              defc fcolor    = 1
   297                              defc    WANT_swapgfxbk = 0
   298                          ENDIF
   299                          
   300                          IF FORmz
   301                              DEFINE gotgfx
   302                              defc maxx    = 80
   303                              defc maxy    = 50
   304                              defc    WANT_swapgfxbk = 0
   305                          ENDIF
   306                          
   307                          IF FORattache
   308                              DEFINE gotgfx
   309                              defc maxx    = 320
   310                              defc maxy    = 240
   311                              defc    WANT_swapgfxbk = 0
   312                          ENDIF
   313                          
   314                          IF FORsvi
   315                              DEFINE gotgfx
   316                              defc maxx    = 256
   317                              defc maxy    = 192
   318                              defc fcolor    = 1
   319                              defc    WANT_swapgfxbk = 0
   320                          ENDIF
   321                          
   322                          IF FORsam
   323                              DEFINE gotgfx
   324                              defc maxx    = 512
   325                              defc maxy    = 192
   326                              defc    WANT_swapgfxbk = 0
   327                          ENDIF
   328                          
   329                          IF FORoz
   330                              DEFINE gotgfx
   331                              defc row_bytes    = 30
   332                              defc maxx    = 239
   333                              defc maxy    = 80
   334                          ENDIF
   335                          
   336                          IF FORosca
   337                              DEFINE gotgfx
   338                              defc maxx    = 320
   339                              defc maxy    = 200
   340                              ; untested 240 lines resolution, see 'libsrc/graphics/osca'
   341                              ;defc maxy    = 240
   342                          ENDIF
   343                          
   344                          IF FORc128hr
   345                              DEFINE gotgfx
   346                              defc maxx    = 640
   347                              defc maxy    = 200
   348                          ENDIF
   349                          
   350                          IF FORc128hr480
   351                              DEFINE gotgfx
   352                              defc maxx    = 640
   353                              defc maxy    = 480
   354                          ENDIF
   355                          
   356                          IF FORts2068
   357                              DEFINE gotgfx
   358                              defc maxx       = 512
   359                              defc maxy       = 192
   360                              defc    WANT_swapgfxbk = 0
   361                          ENDIF
   362                          
   363                          IF FORzxn
   364                              DEFINE gotgfx
   365                              defc maxx       = 512
   366                              defc maxy       = 192
   367                              defc    WANT_swapgfxbk = 0
   368                          ENDIF
   369                          
   370                          IF FORtiki100
   371                              DEFINE gotgfx
   372                              defc maxx       = 1024
   373                              defc maxy       = 256
   374                          ENDIF
   375                          
   376                          IF FORenterprise
   377                              DEFINE gotgfx
   378                              defc maxx       = 336
   379                              defc maxy       = 243
   380                          ENDIF
   381                          
   382                          IF FORenterprisehr
   383                              DEFINE gotgfx
   384                              defc maxx       = 672
   385                              defc maxy       = 243
   386                          ENDIF
   387                          
   388                          IF FORz88
   389                              DEFINE gotgfx
   390                              defc    maxx    = 256
   391                              defc    maxy     = 64
   392                          ENDIF
   393                          
   394                          IF FORz9001
   395                              DEFINE gotgfx
   396                              defc maxx    = 320
   397                              defc maxy    = 192
   398                              defc    WANT_swapgfxbk = 0
   399                              defc blankch = 32
   400                          ENDIF
   401                          
   402                          IF FORkc
   403                              DEFINE gotgfx
   404                              defc maxx    = 320
   405                              defc maxy    = 256
   406                          ENDIF
   407                          
   408                          IF FORaussie
   409                              DEFINE gotgfx
   410                              defc maxx    = 640
   411                              defc maxy    = 576
   412                          ENDIF
   413                          
   414                          IF FORaquarius
   415                              DEFINE gotgfx
   416                              defc maxx    = 80
   417                              defc maxy    = 72
   418                              defc blankch    = 160
   419                          ENDIF
   420                          
   421                          IF FORaqplus
   422                              DEFINE gotgfx
   423                              defc maxx    = 320
   424                              defc maxy    = 299
   425                          ENDIF
   426                          
   427                          IF FORaq48
   428                              DEFINE gotgfx
   429                              defc maxx    = 80
   430                              defc maxy    = 48
   431                              defc blankch    = 160
   432                          ENDIF
   433                          
   434                          IF FORz1013
   435                              DEFINE gotgfx
   436                              defc maxx    = 256
   437                              defc maxy    = 256
   438                              defc    WANT_swapgfxbk = 0
   439                          ENDIF
   440                          
   441                          
   442                          IF FORc128
   443                              DEFINE gotgfx
   444                              defc maxx    = 80
   445                              defc maxy    = 50
   446                              defc blankch    = 32
   447                          ENDIF
   448                          
   449                          IF FORc128udg
   450                              DEFINE gotgfx
   451                              defc maxx    = 80
   452                              defc maxy    = 75
   453                              defc blankch    = 0
   454                          ENDIF
   455                          
   456                          IF FORfp1100
   457                              DEFINE gotgfx
   458                              defc maxx    = 640
   459                              defc maxy    = 200
   460                              defc blankch    = 32
   461                              defc USEplotc   = 1
   462                              defc    WANT_swapgfxbk = 0
   463                          ENDIF
   464                          
   465                          IF FORgal
   466                              DEFINE gotgfx
   467                              ; This size reflects the Gal+ screen mode
   468                                  IF textgraphics
   469                                      defc maxx    = 64
   470                                  defc maxy    = 48
   471                                  ELSE
   472                                      defc maxx    = 256
   473                                  defc maxy    = 208
   474                                  ENDIF
   475                              defc blankch    = 32
   476                              defc    WANT_swapgfxbk = 0
   477                          ENDIF
   478                          
   479                          IF FORnascom
   480                              DEFINE gotgfx
   481                              defc maxx    = 96
   482                              defc maxy    = 48
   483                              defc blankch    = 32
   484                          ENDIF
   485                          
   486                          IF FORtrs80
   487                              DEFINE gotgfx
   488                              defc maxx    = 128
   489                              defc maxy    = 48
   490                              defc blankch    = 128
   491                              defc    WANT_swapgfxbk = 0
   492                          ENDIF
   493                          
   494                          IF FORtrs80m2
   495                              DEFINE gotgfx
   496                              defc maxx    = 80
   497                              defc maxy    = 72
   498                              defc blankch    = 32
   499                              defc GFXTEXT3 = 1
   500                          ENDIF
   501                          
   502                          IF FORtrs80m4
   503                              DEFINE gotgfx
   504                              defc maxx    = 160
   505                              defc maxy    = 72
   506                              defc blankch    = 128
   507                          ENDIF
   508                          
   509                          IF FOReg2000
   510                              DEFINE gotgfx
   511                              defc maxx    = 160
   512                              defc maxy    = 102
   513                          ENDIF
   514                          
   515                          IF FORhrg1
   516                              DEFINE gotgfx
   517                              defc maxx    = 384
   518                              defc maxy    = 192
   519                          ENDIF
   520                          
   521                          IF FORgrafyx3
   522                              DEFINE gotgfx
   523                              defc maxx    = 512
   524                              defc maxy    = 192
   525                          ENDIF
   526                          
   527                          IF FORgrafyx4
   528                              DEFINE gotgfx
   529                              defc maxx    = 640
   530                              defc maxy    = 240
   531                          ENDIF
   532                          
   533                          IF FORp2000
   534                              DEFINE gotgfx
   535                              defc maxx    = 78
   536                              defc maxy    = 72
   537                              defc blankch    = 0
   538                          ENDIF
   539                          
   540                          IF FORpx4
   541                              DEFINE gotgfx
   542                              defc maxx    = 240
   543                              defc maxy    = 64
   544                          ENDIF
   545                          
   546                          IF FORpx8
   547                              DEFINE gotgfx
   548                              defc maxx    = 480
   549                              defc maxy    = 64
   550                          ENDIF
   551                          
   552                          IF FORnc100
   553                              DEFINE gotgfx
   554                              defc maxx    = 480
   555                              defc maxy    = 64
   556                          ENDIF
   557                          
   558                          IF FORnc200
   559                              DEFINE gotgfx
   560                              defc maxx    = 480
   561                              defc maxy    = 128
   562                          ENDIF
   563                          
   564                          IF FORvg5k
   565                              DEFINE gotgfx
   566                              defc maxx    = 80
   567                              defc maxy    = 75
   568                              defc blankch    = 0
   569                              defc    WANT_swapgfxbk = 0
   570                          ENDIF
   571                          
   572                          IF FORsorcerer
   573                              DEFINE gotgfx
   574                              defc maxx    = 128
   575                              defc maxy    = 60
   576                              defc blankch    = 32
   577                          ENDIF
   578                          
   579                          IF FORpacman
   580                              DEFINE gotgfx
   581                              defc maxx    = 84
   582                              defc maxy    = 72
   583                              defc blankch    = 192
   584                          ENDIF
   585                          
   586                          IF FORpv1000
   587                              DEFINE gotgfx
   588                              defc maxx    = 56
   589                              defc maxy    = 48
   590                              defc    WANT_swapgfxbk = 0
   591                          ENDIF
   592                          
   593                          IF FORalphatro
   594                              DEFINE gotgfx
   595                              defc maxx    = 160
   596                              defc maxy    = 72
   597                              defc blankch    = 32
   598                              defc    WANT_swapgfxbk = 0
   599                          ENDIF
   600                          
   601                          IF FORhemc
   602                              DEFINE gotgfx
   603                              defc maxx    = 64        ;Text graphics settings
   604                              defc maxy    = 24
   605                              defc blankch    = 32
   606                              defc USEplotc   = 1        ; We call generic_console_plotc, not _printc for text mode
   607                              defc    WANT_swapgfxbk = 0
   608                          ENDIF
   609                          
   610                          IF FORhgmc
   611                              DEFINE    gotgfx
   612                              defc    maxx = 256
   613                              defc    maxy = 256
   614                              defc    WANT_swapgfxbk = 0
   615                              defc    BITS_reversed = 1
   616                          ENDIF
   617                          
   618                          
   619                          IF FORspc1000
   620                              DEFINE gotgfx
   621                              ;defc maxx    = 64        ;Text graphics settings
   622                              ;defc maxy    = 48
   623                              defc maxx    = 256        ;Graphics/VDP
   624                              defc maxy    = 192
   625                              defc blankch    = 32
   626                              defc USEplotc   = 1        ; We call generic_console_plotc, not _printc for text mode
   627                              defc    WANT_swapgfxbk = 0
   628                          ENDIF
   629                          
   630                          IF FORsmc777
   631                              DEFINE gotgfx
   632                              defc maxx    = 640
   633                              defc maxy    = 200
   634                              defc    WANT_swapgfxbk = 0
   635                          ENDIF
   636                          
   637                          IF FORmulti8
   638                              DEFINE gotgfx
   639                              defc maxx    = 640
   640                              defc maxy    = 200
   641                              defc    WANT_swapgfxbk = 0
   642                          ENDIF
   643                          
   644                          IF FORrx78
   645                              DEFINE gotgfx
   646                              defc maxx    = 192
   647                              defc maxy    = 184
   648                              defc    WANT_swapgfxbk = 0
   649                          ENDIF
   650                          
   651                          IF FORlynx
   652                              DEFINE gotgfx
   653                              defc maxx    = 64        ;Text graphics settings
   654                              defc maxy    = 64
   655                              defc blankch    = 0
   656                              defc USEplotc   = 1        ; We call generic_console_plotc, not _printc for text mode
   657                              defc    WANT_swapgfxbk = 0
   658                          ENDIF
   659                          
   660                          IF FORx1
   661                              DEFINE gotgfx
   662                              defc maxx    = 640
   663                              defc maxy    = 200
   664                              defc    WANT_swapgfxbk = 0
   665                          ENDIF
   666                          
   667                          IF FORlaser500
   668                              DEFINE gotgfx
   669                              defc maxx = 320
   670                              defc maxy = 192
   671                              defc blankch = 32
   672                              defc    WANT_swapgfxbk = 0
   673                          ENDIF
   674                          
   675                          IF FORexcali64
   676                              DEFINE gotgfx
   677                              defc maxx = 160
   678                              defc maxy = 72
   679                              defc blankch = 32
   680                              defc USEplotc   = 1        ; We call generic_console_plotc, not _printc for text mode
   681                              defc USEindex = 1
   682                              defc    WANT_swapgfxbk = 0
   683                          ENDIF
   684                          
   685                          IF FORz80tvgame
   686                              DEFINE gotgfx
   687                              defc maxx = 168
   688                              defc maxy = 208
   689                              defc blankch = 32
   690                              defc    WANT_swapgfxbk = 0
   691                          ENDIF
   692                          
   693                          IF FORsv8000
   694                              DEFINE gotgfx
   695                              defc maxx = 256
   696                              defc maxy = 96
   697                              defc blankch = 32
   698                              defc    WANT_swapgfxbk = 0
   699                          ENDIF
   700                          
   701                          IF FORpmd85
   702                              DEFINE gotgfx
   703                              defc maxx = 288
   704                              defc maxy = 256
   705                              defc blankch = 32
   706                              defc    WANT_swapgfxbk = 0
   707                          ENDIF
   708                          
   709                          IF FORm100
   710                              DEFINE gotgfx
   711                              defc maxx = 240
   712                              defc maxy = 64
   713                          ENDIF
   714                          
   715                          IF FORvector06c
   716                              DEFINE gotgfx
   717                              defc maxx = 256
   718                              defc maxy = 256
   719                              defc blankch = 32
   720                              defc    WANT_swapgfxbk = 0
   721                          ENDIF
   722                          
   723                          IF FORspecial
   724                              DEFINE gotgfx
   725                              defc maxx = 384
   726                              defc maxy = 256
   727                              defc blankch = 32
   728                              defc    WANT_swapgfxbk = 0
   729                          ENDIF
   730                          
   731                          IF FORhomelab
   732                              DEFINE gotgfx
   733                              defc maxx = 128
   734                              defc maxy = 64
   735                              defc    WANT_swapgfxbk = 0
   736                          ENDIF
   737                          
   738                          IF FORhomelab2
   739                              DEFINE gotgfx
   740                              defc maxx = 80
   741                              defc maxy = 50
   742                              defc    WANT_swapgfxbk = 0
   743                          ENDIF
   744                          
   745                          IF FORgb
   746                              defc USEplotc   = 1        ; We call generic_console_plotc, not _printc for text mode
   747                              defc    WANT_swapgfxbk = 0
   748                          ENDIF
   749                          
   750                          IF FORmikro80
   751                              defc USEplotc = 1
   752                              defc    WANT_swapgfxbk = 0
   753                          ENDIF
   754                          
   755                          IF FORondra
   756                              DEFINE gotgfx
   757                              defc maxx    = 320
   758                              defc maxy    = 256
   759                              defc    WANT_swapgfxbk = 0
   760                          ENDIF
   761                          
   762                          IF FORlviv
   763                              DEFINE gotgfx
   764                              defc maxx    = 256
   765                              defc maxy    = 256
   766                              defc    WANT_swapgfxbk = 0
   767                          ENDIF
   768                          
   769                          IF FORvti
   770                              DEFINE gotgfx
   771                              defc maxx    = 128
   772                              defc maxy    = 48
   773                              defc USEplotc   = 1        ; We call generic_console_plotc, not _printc for text mode
   774                              defc blankch    = 160
   775                              defc    WANT_swapgfxbk = 0
   776                          ENDIF
   777                          
   778                          IF FORvio
   779                              DEFINE gotgfx
   780                              defc maxx    = 160
   781                              defc maxy    = 72
   782                              defc blankch    = 32
   783                              defc    WANT_swapgfxbk = 0
   784                          ENDIF
   785                          
   786                          IF FORvdm
   787                              DEFINE gotgfx
   788                              defc maxx    = 64
   789                              defc maxy    = 16
   790                              defc USEplotc   = 1        ; We call generic_console_plotc, not _printc for text mode
   791                              defc    WANT_swapgfxbk = 0
   792                          ENDIF
   793                          
   794                          IF FORkrokha
   795                              DEFINE gotgfx
   796                              defc maxx    = 96
   797                              defc maxy    = 64
   798                              defc    WANT_swapgfxbk = 0
   799                          ENDIF
   800                          
   801                          IF FORgl6000
   802                              DEFINE gotgfx
   803                              defc maxx    = 240
   804                              defc maxy    = 100
   805                              defc    WANT_swapgfxbk = 0
   806                          ENDIF
   807                          
   808                          IF FORsol20
   809                              DEFINE gotgfx
   810                              defc maxx    = 64
   811                              defc maxy    = 16
   812                              defc USEplotc = 1
   813                          ENDIF
   814                          
   815                          ; GSX virtual window is (32768 x 32768)
   816                          ; HiRez display should stay between 512..800 px.
   817                          ; We keep an average value
   818                          IF FORcpm
   819                            IF FORgsx
   820                              DEFINE gotgfx
   821                              defc maxx    = 1920        ; foo value hopefully larger than the max X resolution
   822                              defc maxy    = 768        ; we keep unbalanced proportions, assuming non-square pixels
   823                            ENDIF
   824                          ENDIF
   825                          
   826                          ; =============================================
   827                          
   828                          IF FORtek
   829                             DEFINE gotgfx
   830                             defc maxx = 1024
   831                             defc maxy = 768
   832                             defc    WANT_swapgfxbk = 0
   833                          ENDIF
   834                          
   835                          IF FORregis
   836                             DEFINE gotgfx
   837                             defc maxx = 768
   838                             defc maxy = 480
   839                          ENDIF
   840                          
   841                          IF FORagon
   842                             DEFINE gotgfx
   843                             defc maxx = 1024
   844                             defc maxy = 768
   845                             defc    WANT_swapgfxbk = 0
   846                          ENDIF
   847                          
   848                          IF FORtim011
   849                             DEFINE gotgfx
   850                             defc maxx = 512
   851                             defc maxy = 256
   852                             defc    WANT_swapgfxbk = 0
   853                          ENDIF
   854                          
   855                          ; Catch all to sort things out
   856                          
   857                          IF !gotgfx
   858                              defc    maxx = 256
   859                              defc    maxy = 192
   860                          ENDIF
   861                          
   862                          IF WANT_swapgfxbk
   863                              defc    NEED_swapgfxbk = 0
   864                          ELSE
   865                              defc    NEED_swapgfxbk = 1
   866                          ENDIF
   867                          
   868                          
   869                          
   870                          ;       Structure for open window       struct *window
   871                          
   872                          DEFVARS 0
   873                          {
   874                                  windnum ds.b    1
   875                                  wind_x  ds.b    1
   876                                  wind_y  ds.b    1
   877                                  wind_w  ds.b    1       ;width/map width
   878                                  wind_d  ds.b    1       ;
   879                                  type    ds.b    1       ;
   880                                  graph   ds.b    1       ;0=text 1=graphics
   881                          }
   882                          
liner2.asm:
     2                          
     3                            IF    !__CPU_INTEL__&!__CPU_GBZ80__
     4                                  SECTION code_graphics
     5                                  PUBLIC  Line_r
     6                          
     7                                  EXTERN  __gfx_coords
     8                          
     9                          ;
    10                          ;    $Id: liner2.asm $
    11                          ;
    12                          
    13                          ;    ...SLLLOOOW Variant by Stefano Bodrato
    14                          ;    with the alternate registers left untouched and 8080 compatible instructions
    15                          
    16                          ; ******************************************************************************
    17                          ;
    18                          ;    Draw a pixel line from (x0,y0) defined in (COORDS) - the current plot
    19                          ;    coordinate, to the relative distance points (x0+x,y0+y).
    20                          ;
    21                          ;    Design & programming by Gunther Strube,    Copyright (C) InterLogic 1995
    22                          ;
    23                          ;    The (COORDS+0)    pointer contains the current y coordinate, (COORDS+1) the
    24                          ;    current x coordinate. The main program should reset the (COORDS) variables
    25                          ;    before using line drawing.
    26                          ;
    27                          ;    The routine checks the range of specified coordinates which is the
    28                          ;    boundaries of the graphics area (256x64    pixels).
    29                          ;    If a boundary error occurs the routine exits automatically.    This may be
    30                          ;    useful if you are trying to draw a line longer than allowed. Only the
    31                          ;    visible part will be drawn.
    32                          ;
    33                          ;    The hardware graphics memory is organized as (0,0) in the top left corner.
    34                          ;
    35                          ;    The plot routine is    defined by an address pointer    in IX.
    36                          ;
    37                          ;    IN:    HL =    move    relative x horisontal points (maximum +/- 255).
    38                          ;    DE =    move    relative y vertical    points (maximum +/-    255).
    39                          ;    IX =    pointer to plot routine that uses HL = (x,y)    of plot coordinate.
    40                          ;
    41                          ;    OUT:    None.
    42                          ;
    43                          ;    Registers    used    by routine:
    44                          ;      N    :    B, loop counter
    45                          ;      i    :    line    balance variable
    46                          ;      x    :    H/L,    horisontal, vertical distance    variables
    47                          ;      y    :    H/L,    horisontal, vertical distance    variables
    48                          ;    (x0,y0)    :    (h,l)
    49                          ;    direc_x    :    d, horisontal step increment
    50                          ;    direc_y    :    e, vertical step increment
    51                          ;    ddx    :    b, horisontal step increment
    52                          ;    ddy    :    c, vertical step increment
    53                          ;
    54                          ;    DE, A work registers.
    55                          ;
    56                          ; The algorithm in pseudo-code:
    57                          ;
    58                          ;    direc_x =    SGN x: direc_y    = SGN y
    59                          ;    x = ABS x: y =    ABS y
    60                          ;
    61                          ;    if x    >= y
    62                          ;    if x+y=0 then return
    63                          ;    H = x
    64                          ;    L = y
    65                          ;    ddx = direc_x
    66                          ;    ddy = 0
    67                          ;    else
    68                          ;    H = y
    69                          ;    L = x
    70                          ;    ddx = 0
    71                          ;    ddy = direc_y
    72                          ;    endif
    73                          ;
    74                          ;    B = H
    75                          ;    i = INT(B/2)
    76                          ;    FOR N=B TO 1 STEP -1
    77                          ;    i = i + L
    78                          ;    if i    < H
    79                          ;    ix =    ddx
    80                          ;    iy =    ddy
    81                          ;    else
    82                          ;    i = i - H
    83                          ;    ix =    direc_x
    84                          ;    iy =    direc_y
    85                          ;    endif
    86                          ;    x0 =    x0 +    ix
    87                          ;    y0 =    y0 +    iy
    88                          ;    plot    (x0,y0)
    89                          ;    NEXT    N
    90                          ;
    91                          ;
    92                          ;    Registers    changed after return:
    93                          ;    ..BCDEHL/IXIY/af......    same
    94                          ;    AF....../..../..bcdehl    different
    95                          ;
    96                          Line_r: push    bc
    97                                  push    de                      ; preserve relative    vertical distance
    98                                  push    hl                      ; preserve relative    horisontal distance
    99                          
   100                                  push    de
   101                                  push    hl
   102                          
   103                              ;exx
   104                                  push    bc
   105                                  push    de
   106                                  ld      bc, (bc1save)
   107                                  ld      de, (de1save)
   108                                  pop     hl
   109                                  ld      (de1save), hl
   110                                  pop     hl
   111                                  ld      (bc1save), hl
   112                          
   113                                  pop     hl                      ; get relative    horisontal movement
   114                                  call    sgn
   115                                  ld      d, a                    ; direc_x    = SGN(x) installed
   116                                  call    abs
   117                                  ld      b, l                    ; x = ABS(x)
   118                          
   119                                  pop     hl                      ; get relative    vertical movement
   120                                  call    sgn
   121                                  ld      e, a                    ; direc_y    = SGN(y) installed
   122                                  call    abs
   123                                  ld      c, l                    ; y = ABS(y)
   124                                  push    bc
   125                          
   126                              ;exx
   127                                  push    bc
   128                                  push    de
   129                                  ld      bc, (bc1save)
   130                                  ld      de, (de1save)
   131                                  pop     hl
   132                                  ld      (de1save), hl
   133                                  pop     hl
   134                                  ld      (bc1save), hl
   135                          
   136                                  pop     hl                      ; H = absolute    x dist., L = absolute y distance
   137                          
   138                                  ld      a, h
   139                                  cp      l
   140                                  jr      c, x_smaller_y          ; if    x >=    y
   141                                  or      h                       ;    if x+y = 0
   142                                  jp      z, exit_draw            ;    return
   143                          
   144                                 ;exx    ;    else
   145                                  push    hl
   146                                  push    bc
   147                                  push    de
   148                                  ld      bc, (bc1save)
   149                                  ld      de, (de1save)
   150                                  pop     hl
   151                                  ld      (de1save), hl
   152                                  pop     hl
   153                                  ld      (bc1save), hl
   154                                  pop     hl
   155                          
   156                                  ld      b, d                    ;    ddx = direc_x
   157                                  ld      c, 0                    ;    ddy = 0
   158                          
   159                                 ;exx
   160                                  push    hl
   161                                  push    bc
   162                                  push    de
   163                                  ld      bc, (bc1save)
   164                                  ld      de, (de1save)
   165                                  pop     hl
   166                                  ld      (de1save), hl
   167                                  pop     hl
   168                                  ld      (bc1save), hl
   169                                  pop     hl
   170                          
   171                                  jr      init_drawloop           ; else
   172                          x_smaller_y:
   173                                  ld      a, h
   174                                  ld      h, l                    ;    H = y
   175                                  ld      l, a                    ;    L = x
   176                          
   177                                 ;exx
   178                                  push    hl
   179                                  push    bc
   180                                  push    de
   181                                  ld      bc, (bc1save)
   182                                  ld      de, (de1save)
   183                                  pop     hl
   184                                  ld      (de1save), hl
   185                                  pop     hl
   186                                  ld      (bc1save), hl
   187                                  pop     hl
   188                          
   189                                  ld      b, 0                    ;    ddx = 0
   190                                  ld      c, e                    ;    ddy = direc_y
   191                          
   192                                 ;exx
   193                                  push    hl
   194                                  push    bc
   195                                  push    de
   196                                  ld      bc, (bc1save)
   197                                  ld      de, (de1save)
   198                                  pop     hl
   199                                  ld      (de1save), hl
   200                                  pop     hl
   201                                  ld      (bc1save), hl
   202                                  pop     hl
   203                          
   204                          init_drawloop:
   205                                  ld      b, h
   206                                  ld      c, h                    ; B = H
   207                              ;srl    c    ; i = INT(B/2)
   208                                  xor     a
   209                                  add     c
   210                                  rra
   211                                  ld      c, a
   212                                    ; FOR N=B    TO 1    STEP    -1
   213                          drawloop:
   214                          
   215                                  xor     a                       ; (Stefano)
   216                                  or      h                       ; .. vertical line drawing was slow
   217                                  jr      z, i_greater            ; this shortcut seems to solve the problem
   218                          
   219                                  ld      a, c
   220                                  add     a, l
   221                                  jr      c, i_greater            ;    i + L > 255  (i > H)
   222                                  cp      h
   223                                  jr      nc, i_greater           ;    if i    < H
   224                                  ld      c, a                    ;    i = i + L
   225                          
   226                                 ;exx
   227                                  push    hl
   228                                  push    bc
   229                                  push    de
   230                                  ld      bc, (bc1save)
   231                                  ld      de, (de1save)
   232                                  pop     hl
   233                                  ld      (de1save), hl
   234                                  pop     hl
   235                                  ld      (bc1save), hl
   236                                  pop     hl
   237                          
   238                                  push    bc                      ;    ix =    ddx:    iy =    ddy
   239                          
   240                                 ;exx
   241                                  push    hl
   242                                  push    bc
   243                                  push    de
   244                                  ld      bc, (bc1save)
   245                                  ld      de, (de1save)
   246                                  pop     hl
   247                                  ld      (de1save), hl
   248                                  pop     hl
   249                                  ld      (bc1save), hl
   250                                  pop     hl
   251                          
   252                                  jr      check_plot              ;    else
   253                          i_greater:
   254                                  sub     h                       ;    i = i - H
   255                                  ld      c, a
   256                          
   257                                 ;exx
   258                                  push    hl
   259                                  push    bc
   260                                  push    de
   261                                  ld      bc, (bc1save)
   262                                  ld      de, (de1save)
   263                                  pop     hl
   264                                  ld      (de1save), hl
   265                                  pop     hl
   266                                  ld      (bc1save), hl
   267                                  pop     hl
   268                          
   269                                  push    de                      ;    ix =    direc_x: iy = direc_y
   270                          
   271                                 ;exx    ;    endif
   272                                  push    hl
   273                                  push    bc
   274                                  push    de
   275                                  ld      bc, (bc1save)
   276                                  ld      de, (de1save)
   277                                  pop     hl
   278                                  ld      (de1save), hl
   279                                  pop     hl
   280                                  ld      (bc1save), hl
   281                                  pop     hl
   282                          
   283                          check_plot:
   284                                  ex      (sp), hl                ;    preserve H,L distances on stack
   285                                  ex      de, hl                  ;    D,E = ix,    iy
   286                                  ld      hl, (__gfx_coords)
   287                                  ld      a, l
   288                                  add     a, e                    ;
   289                                  ld      l, a                    ;    y0 =    y0 +    iy (y0 is    checked by plot)
   290                          
   291                                  ld      a, d
   292                                  inc     a
   293                                  add     a, h
   294                                  jr      c, check_range          ;    check out    of range
   295                                  jr      z, range_error          ;    Fz=1    & Fc=0 denotes    x0 <    0
   296                                  jr      plot_point
   297                          check_range:
   298                                  jr      nz, range_error         ;    Fz=0    & Fc=1 denotes    x0 >    255
   299                          
   300                          plot_point:
   301                                  dec     a
   302                                  ld      h, a                    ;    x0 =    x0 +    ix
   303                                  ld      de, plot_RET
   304                                  push    de                      ;    hl =    (x0,y0)...
   305                                  jp      (ix)                    ;    execute PLOT at (x0,y0)
   306                          plot_RET:
   307                                  pop     hl                      ;    restore H,L distances...
   308                              ;djnz    drawloop    ; NEXT N
   309                                  dec     b
   310                                  jp      nz, drawloop
   311                                  jr      exit_draw
   312                          range_error:
   313                                  pop     hl                      ; remove H,L distances...
   314                          exit_draw:
   315                                  pop     hl                      ; restore    relative horisontal    distance
   316                                  pop     de                      ; restore    relative vertical distance
   317                                  pop     bc
   318                                  ret
   319                          
   320                          
   321                          ; ******************************************************************************
   322                          ;
   323                          ;    SGN (Signum value) of 16    bit signed integer.
   324                          ;
   325                          ;    IN:    HL =    integer
   326                          ;    OUT:    A = result: 0,1,-1 (if zero, positive, negative)
   327                          ;
   328                          ;    Registers    changed after return:
   329                          ;    ..BCDEHL/IXIY    same
   330                          ;    AF....../....    different
   331                          ;
   332                          sgn:    ld      a, h
   333                                  or      l
   334                                  ret     z                       ; integer    is zero, return 0...
   335                          ;    bit    7,h
   336                                  ld      a, 128                  ; trying to be 8080 compatible  ;)
   337                                  and     h
   338                                  jr      nz, negative_int
   339                                  ld      a, 1
   340                                  ret
   341                          negative_int:
   342                                  ld      a, -1
   343                                  ret
   344                          
   345                          
   346                          ; ******************************************************************************
   347                          ;
   348                          ;    ABS (Absolute value) of 16 bit signed integer.
   349                          ;
   350                          ;    IN:    HL =    integer
   351                          ;    OUT:    HL =    converted    integer
   352                          ;
   353                          ;    Registers    changed after return:
   354                          ;    A.BCDE../IXIY    same
   355                          ;    .F....HL/....    different
   356                          ;
   357                          abs:
   358                          ;    bit    7,h
   359                                  ld      a, 128                  ; trying to be 8080 compatible  ;)
   360                                  and     h
   361                                  ret     z                       ; integer    is positive...
   362                          ;    push    de
   363                          ;    ex    de,hl
   364                              ;ld    hl,0
   365                              ;cp    a    ; Fc    = 0,    may not be used...
   366                              ;sbc    hl,de    ; convert    negative integer
   367                                  xor     a
   368                                  sub     l
   369                                  ld      l, a
   370                          ;	ld    a,0	; values between 0..255 are expected
   371                          ;	sbc   h
   372                          ;	ld    h,a
   373                          
   374                          ;    pop    de
   375                                  ret
   376                          
   377                                  SECTION bss_graphics
   378                          bc1save:
   379                                  defw    0
   380                          de1save:
   381                                  defw    0
   382                            ENDIF
   383                          
