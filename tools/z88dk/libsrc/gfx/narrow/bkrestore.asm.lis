/tmp/tmpXX0zS5cP.asm:
     1                          MODULE bkrestore_asm
     2                          LINE 0, "bkrestore.asm"
bkrestore.asm:
                                
     1                          ;
     2                          ;    Fast background restore
     3                          ;
     4                          ;    Generic version (just a bit slow)
     5                          ;
     6                          ;    $Id: bkrestore.asm $
     7                          ;
     8                          
     9                            IF    !__CPU_INTEL__&!__CPU_GBZ80__
    10                                  SECTION smc_clib
    11                          
    12                                  EXTERN  pixeladdress
    13                          
    14                                  PUBLIC  bkrestore
    15                                  PUBLIC  _bkrestore
    16                                  PUBLIC  bkrestore_fastcall
    17                                  PUBLIC  _bkrestore_fastcall
    18                          
    19                          bkrestore:
    20                          _bkrestore:
    21                                  pop     de
    22                                  pop     hl
    23                                  push    hl
    24                                  push    de
    25                          
    26                          bkrestore_fastcall:
    27                          _bkrestore_fastcall:
    28                                  push    ix
    29                          ; __FASTCALL__ : sprite ptr in HL
    30                          
    31                                  push    hl
    32                                  pop     ix
    33                          
    34                                  ld      h, (ix+2)
    35                                  ld      l, (ix+3)
    36                          
    37                                  push    hl
    38                                  call    pixeladdress
    39                                  pop     hl
    40                          
    41                                  ld      a, (ix+0)
    42                                  ld      b, (ix+1)
    43                          
    44                                  dec     a
    45                                  srl     a
    46                                  srl     a
    47                                  srl     a
    48                                  inc     a
    49                                  inc     a                       ; INT ((Xsize-1)/8+2)
    50                                  ld      (rbytes+1), a
    51                          
    52                          bkrestores:
    53                                  push    bc
    54                          rbytes:
    55                                  ld      b, 0
    56                          rloop:
    57                                  ld      a, (ix+4)
    58                                  ld      (de), a
    59                                  inc     de
    60                                  inc     ix
    61                                  djnz    rloop
    62                          
    63                                  inc     l
    64                                  push    hl
    65                                  call    pixeladdress
    66                                  pop     hl
    67                          
    68                                  pop     bc
    69                                  djnz    bkrestores
    70                                  pop     ix
    71                                  ret
    72                            ENDIF
    73                          
